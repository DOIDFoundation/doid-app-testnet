import{a as H,b as D,u as J,c as G,n as W,e as P,_ as X,d as B,f as M,h as b,i as Y,j as Z,k as tt,l as et,w as N,m as j,g as st,T as C}from"./index-a026c03f.js";import{p as x,S as z,A as K,B as it,D as rt,y as v,n as y,q as u,e as k,b as q,E as nt,F as at,u as ot}from"./vendor-3bc81e08.js";const w=async()=>H("Resolver");var lt=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,ut=(i,e,s,r)=>{for(var t=r>1?void 0:r?ct(e,s):e,n=i.length-1,a;n>=0;n--)(a=i[n])&&(t=(r?a(e,s,t):a(t))||t);return r&&t&&lt(e,s,t),t};class V extends z{constructor(e){super(),this.key="",this.key=e}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}ut([x({value:[]})],V.prototype,"queue",2);const dt=7200*1e3;class ht{constructor(e){this.provider=J().bridgeStore.bridge.provider,this.store=new V(`evm.txs.${e||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(e){if(!e.chainId){const{network:s}=this.provider;e.chainId=s.chainId,e.scan=s.scan}e.pending=!0,this.queue.unshift(e),this.store.save(),this.provider.nonce=+e.nonce+1}delDelay(e,s=0){setTimeout(()=>this.del(e),s)}del(e){var r,t;const s=(t=(r=e.hash)!=null?r:e.ts)!=null?t:e;this.queue.some((n,a)=>{if([n.hash,n.ts,n].includes(s)){a===0&&(this.provider.nonce=0);const o=this.queue.splice(a,1);return this.store.save(),o}})}async check(e){this.queue.forEach(async(s,r)=>{if(e&&r===0){const t=await G(this.provider.account),n=+s.nonce;this.provider.nonce=n>t?n+1:t}if(s.done||new Date().getTime()-s.ts>=dt)return this.del(s);if(!s.err&&!(!e&&s.pending)){s.pending=!0;try{const t=await this.provider.waitForTransaction(s.hash),{status:n}=t;s.status=n,n===1?(s.done=!0,this.del(s)):s.err=!0}catch(t){s.err=t}s.pending=!1}}),this.store.save()}}const L={},O=(i=D.bridge.account)=>L[i]||(L[i]=new ht(i)),pt=async i=>i?typeof i=="object"?i:await X(Object.assign({"./abi/Locker.codes.json":()=>B(()=>import("./Locker.codes-d3f42ed5.js"),[]),"./abi/Resolver.codes.json":()=>B(()=>import("./Resolver.codes-ee4f74d3.js"),[])}),`./abi/${i}.codes.json`):{};class gt{constructor(e,{errorCodes:s="",seq:r=void 0,delay:t=0,allowAlmostSuccess:n=!1,onSent:a=()=>{},onSuccess:o=()=>{},onError:l=()=>{}}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=n,this.txPromise=e,this.err=void 0,this.hash="",this.errorCodes=s,this.seq=r,this.delay=t,this.onSent=a,this.onSuccess=o,this.onError=l}get success(){return this.status===1}get processing(){return this.status===2}get almostSuccess(){return this.status===4}get ignored(){return this.status===3}async wait(e=!1){return(async()=>{let s=!1;const r=await pt(this.errorCodes);try{const t=await this.txPromise;this.onSent(t);const{hash:n,nonce:a}=t;this.seq.nonce=a,this.seq&&(delete this.seq.overrides,O().add(Object.assign(this.seq,{hash:n}))),this.hash=n,this.status=2;const o=async()=>{const{status:l,events:h}=await t.wait(1);if(l!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");h.some(({event:m,args:R}={})=>{if(m==="Failure"){let{info:f,detail:$,error:_}=R;const T=_.toString(),A=r[_],Q={code:T,message:A,error:_,info:f==null?void 0:f.toString(),detail:$==null?void 0:$.toString()};this.seq&&(this.seq.err=!0);const E=new Error(A);throw Object.assign(E,{code:T,raw:Q}),this.allowAlmostSuccess&&(this.status=4),E}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?O().delDelay(n,this.delay):O().del(n)};e?(s=!0,o()):await o(),this.onSuccess(t)}catch(t){throw await W(t),t.code===4001?this.status=3:this.status!==4&&(this.status=0),this.err=t,this.onError(t),t}finally{this.pending=!1;const t=this.status===1;P.emit("tx-status",this.hash),t&&P.emit("tx-success",this.hash),s=t}return s})()}}const U=(i,e={})=>{var f;const s={...i,...e},{owner:r,status:t,account:n}=s,a=!!n&&r.toLowerCase()===n.toLowerCase(),o=t==="locked",l=t==="available"||a&&o,h=t==="registered";let m=o?"Locked by pass":l?"Available":"Unavailable";return h&&a&&(m="Registered"),{name:N((f=s.name)!=null?f:ft),owner:r,available:l,registered:h,stat:m,status:t,itsme:a,id:K(s.id||0,0),locked:o}},mt=async(i,e)=>{const s=async r=>{e||(e=await M());const t=await w(),n={name:N(r),account:e};try{const a=await t.statusOfName(b(r));Object.assign(n,U(a,n))}catch(a){}return n};return Array.isArray(i)?await Promise.all(i.map(s)):await s(i)},Rt=async(i,e)=>{e||(e=await M());const s=await w(),r=[];try{const t=await s.namesOfOwner(i);r.push(...t.map(n=>U(n,{owner:i,account:e,status:"registered"})))}catch(t){}return r},Tt=async i=>{if(!i)return;let e=b(i),s=await w();const r=await s.nameHash(e),t=await s.addrs(r),n=Y();return t.forEach(([a,o])=>{const l=K(a,0);n[l]&&(n[l].address=o)}),Object.values(n)},At=async(i,e,s)=>{let r=await w();const t=await Z(),n=b(i),a=await t.getBlockNumber(),o=(await t.getBlock(a)).timestamp,l=it.from(rt(32)),h=await r.makeAddrMessage(n,s,e,o,l);return{name:i,dest:e,timestamp:o,nonce:l._hex,message:h}},Et=async i=>({signature:await(await tt()).signMessage(i)}),Bt=async(i,e,s,r,t,n)=>{let a=await w();const o="setAddr",l={},h=[b(i),e,s,+r,t,n];await et(l,a,o,h);const m=a[o](...h);return new gt(m,{errorCodes:"Resolver",allowAlmostSuccess:!0,seq:{type:"setAddr",title:`set Address ${s}`,ts:new Date().getTime(),overrides:l}})},ft=()=>"";var yt=Object.defineProperty,vt=Object.getOwnPropertyDescriptor,I=(i,e,s,r)=>{for(var t=r>1?void 0:r?vt(e,s):e,n=i.length-1,a;n>=0;n--)(a=i[n])&&(t=(r?a(e,s,t):a(t))||t);return r&&t&&yt(e,s,t),t};class S extends z{constructor(){super(...arguments),this.search=async e=>{this.pending=!0,this.names=[];const{address:s,name:r}=j(e,{allowAddress:!0});if(s)return st(`/address/${s}`);if(r){const t=await mt([r]);this.names=[t[0]]}this.ts++,this.pending=!1}}get len(){return this.names.length}get empty(){return!this.pending&&!this.len}}I([x({value:!1})],S.prototype,"pending",2);I([x({value:[]})],S.prototype,"names",2);I([x({value:0})],S.prototype,"ts",2);const wt=new S,bt=function({allowAddress:i=!1}={}){return this.inputNameRef||console.error("Please ref(this.inputNameRef) first"),this.validateDOIDName=e=>{const s={allowAddress:i};isNaN(this.nameMinLen)||(s.len=+this.nameMinLen);const r=j(e.detail,s),{name:t="",address:n="",error:a,msg:o}=r;return this.name=i?t||n:t,a?{error:a,msg:o}:(this.inputNameRef.value.$("input").value=this.name,r)}},xt=`.dui-input-text{position:relative;margin-left:auto;margin-right:auto;display:flex;width:100%;padding-top:1.25rem;padding-bottom:1.25rem}.dui-input-text input[type]{font-family:var(--fontFamily);position:relative;display:inline-flex;width:100%;border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));padding:1.5rem .75rem;font-size:1rem;line-height:1.5rem;border:1px solid #ccc;height:2rem}.dui-input-text[disabled]{opacity:.6}.dui-input-text.sm input[type]{padding-top:1rem;padding-bottom:1rem;font-size:.875rem;line-height:1.25rem;height:1.5rem}.dui-input-text.sm .dui-input-right,.dui-input-text.sm .dui-input-left{line-height:1rem;padding-top:1rem;padding-bottom:1rem}.dui-input-text .dui-input-msg,.dui-input-text .dui-input-tip,.dui-input-text label{line-height:1!important}.dui-input-text .dui-input-msg,.dui-input-text .dui-input-tip,.dui-input-text label{position:absolute;display:flex;height:1rem;align-items:center;justify-content:center;padding-left:.75rem;padding-right:.75rem;font-size:.875rem;line-height:1.25rem;margin-left:1px;top:.15rem}.dui-input-text .dui-input-msg{top:auto;bottom:.15rem}.dui-input-text .dui-input-tip{left:auto;right:0px}.dui-input-text .dui-input-right,.dui-input-text .dui-input-left{position:absolute;display:flex;align-items:center;justify-content:center;border-top-right-radius:.375rem;border-bottom-right-radius:.375rem;padding:1.5rem .5rem;z-index:1;right:1px;min-width:1.5rem;margin-top:1px;height:1.5rem;font-size:1em;line-height:1em}.dui-input-text .dui-input-right:empty,.dui-input-text .dui-input-left:empty{--tw-bg-opacity: 1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.dui-input-text .dui-input-left{right:auto;left:1px}.dui-input-text[required] label:after{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;font-weight:600;line-height:1;--tw-text-opacity: 1;color:rgba(239,68,68,var(--tw-text-opacity));content:"*";height:1em;margin-left:.25em}.dui-input-text[rightSlotted] input[type]{padding-right:5rem}.dui-input-text[leftSlotted] input[type]{padding-left:2.75rem}
`;var St=Object.defineProperty,$t=Object.getOwnPropertyDescriptor,d=(i,e,s,r)=>{for(var t=r>1?void 0:r?$t(e,s):e,n=i.length-1,a;n>=0;n--)(a=i[n])&&(t=(r?a(e,s,t):a(t))||t);return r&&t&&St(e,s,t),t};let c=class extends C(xt){constructor(){super(...arguments),this.placeholder="",this.type="text",this.class="",this.value="",this.disabled=!1,this.autoforce=!1,this.required=!1,this.lower=!1,this.upper=!1,this.err=!1,this.debounce=300,this.rightSlotted=!1,this.leftSlotted=!1,this.onKeyup=i=>{i.key==="Enter"&&(this.emit("submit",this.value),setTimeout(()=>this.updateVal()))}}onSlotChange(i){const e=i.target;if(!e)return;e.assignedNodes({flatten:!0}).length}onSlotRight(i){this.rightSlotted=!!i.target}onSlotLeft(i){this.leftSlotted=!!i.target}firstUpdated(){if(this.autoforce){const i=this.$("input");i.focus(),i.select()}}onFocus(i){i.target.select()}updateVal(){const i=this.$("input");i&&(i.value=this.value)}onInput(i){i.stopImmediatePropagation();let e=i.target.value;this.lower&&(e=e.toLowerCase()),this.upper&&(e=e.toUpperCase()),this.value=e,this.updateVal(),this.emit("input",e)}render(){return v`<div class="dui-input-text ${this.class}" ?required="${this.required}" ?rightSlotted="${this.rightSlotted}" ?leftSlotted="${this.leftSlotted}" part="dui-input-text"><label><slot name="label" @slotchange="${this.onSlotChange}"></slot></label> <span class="dui-input-left"><slot name="left" @slotchange="${this.onSlotLeft}"></slot></span><input .type="${this.type}" .disabled="${this.disabled}" placeholder="${this.placeholder}" value="${this.value}" title="${this.title}" @focus="${this.onFocus}" @input="${this.onInput}" @keyup="${this.onKeyup}"><div class="dui-input-right"><slot name="right" @slotchange="${this.onSlotRight}"></slot></div><div class="dui-input-msg"><slot name="msg" @slotchange="${this.onSlotChange}"></slot></div><div class="dui-input-tip"><slot name="tip" @slotchange="${this.onSlotChange}"></slot></div></div>`}};d([u({type:String})],c.prototype,"placeholder",2);d([u({type:String})],c.prototype,"type",2);d([u({type:String})],c.prototype,"class",2);d([u({type:String})],c.prototype,"value",2);d([u({type:Boolean})],c.prototype,"disabled",2);d([u({type:Boolean})],c.prototype,"autoforce",2);d([u({type:Boolean})],c.prototype,"required",2);d([u({type:Boolean})],c.prototype,"lower",2);d([u({type:Boolean})],c.prototype,"upper",2);d([u({type:Boolean})],c.prototype,"err",2);d([u({type:Number})],c.prototype,"debounce",2);d([y()],c.prototype,"rightSlotted",2);d([y()],c.prototype,"leftSlotted",2);c=d([k("dui-input-text")],c);const _t="";var Ot=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,g=(i,e,s,r)=>{for(var t=r>1?void 0:r?Dt(e,s):e,n=i.length-1,a;n>=0;n--)(a=i[n])&&(t=(r?a(e,s,t):a(t))||t);return r&&t&&Ot(e,s,t),t};let p=class extends C(_t){constructor(){super(),this.bindStore=new q(this,wt),this.bindBridge=new q(this,D),this.placeholder="",this.min=2,this.keyword="",this.err="",this.pending={tx:!1,keyword:!1},this.checkedKeyword={},this.inputNameRef=nt(),this.onInput=i=>{const{val:e,error:s,msg:r}=this.validateDOIDName(i);this.err=r,!s&&(this.keyword=e)},bt.bind(this,{allowAddress:!0})()}doSearch(){if(!D.bridge.account)return P.emit("connect-wallet");this.err||(this.checkedKeyword.name&&(this.keyword=N(this.keyword)),this.emit("search",this.keyword))}connectedCallback(){super.connectedCallback();const{name:i="",address:e=""}=j(this.text);this.keyword=i||e}render(){return v`<dui-input-text class="scan-search" ${at(this.inputNameRef)} @input="${this.onInput}" @submit="${this.doSearch}" value="${this.keyword}" placeholder="${this.placeholder}" ?disabled="${this.pending.tx}"><span slot="label"><slot name="label"></slot></span><span slot="right" class="-mr-1"><dui-button @click="${this.doSearch}" icon sm class="text-blue-500"><i class="mdi mdi-magnify text-lg"></i></dui-button></span><span slot="msg">${ot(this.err,()=>v`<span class="text-red-500">${this.err}</span>`,()=>v`<slot name="msgd"><span class="text-gray-400">Start looking up an artist or artwork by DOID, e.g. nocreative.doid, 5h.reva.doid/#3</span></slot>`)}</span></dui-input-text>`}};g([u()],p.prototype,"placeholder",2);g([u()],p.prototype,"min",2);g([u()],p.prototype,"text",2);g([y()],p.prototype,"keyword",2);g([y()],p.prototype,"err",2);g([y()],p.prototype,"pending",2);g([y()],p.prototype,"checkedKeyword",2);p=g([k("dui-ns-search")],p);const Pt="/assets/doid-15c8a698.svg";var Nt=Object.defineProperty,jt=Object.getOwnPropertyDescriptor,Ct=(i,e,s,r)=>{for(var t=r>1?void 0:r?jt(e,s):e,n=i.length-1,a;n>=0;n--)(a=i[n])&&(t=(r?a(e,s,t):a(t))||t);return r&&t&&Nt(e,s,t),t};let F=class extends C(""){render(){return v`<strong class="block w-24 h-24 m-12 mx-auto" href="/"><img class="w-full h-full object-contain select-none pointer-events-none" src="${Pt}"></strong><div class="my-8 text-center"><strong class="block"><slot name="h1"></slot></strong><slot name="msg"></slot></div>`}};F=Ct([k("doid-symbol")],F);export{At as a,Et as b,Bt as c,Rt as d,w as g,mt as n,Tt as o,wt as s,gt as t};
