import{k as q,j as U,f as H,T as w,b,s as it,a as rt,g as N,l as at,m as nt,e as R,o as ot,r as ct}from"./index-7460efd4.js";import{g as W,t as z,b as X,a as dt,c as lt,d as ht,o as pt,w as J,n as mt}from"./doid-symbol-39f30bd9.js";import{E as Z,b as T,y as o,h as d,e as v,n as l,j as gt,f as c,m as ut,d as f,$ as K,k as L,c as ft}from"./vendor-948e5cfe.js";const F=async(t,s=localStorage,r=!1)=>{const i=async()=>{const a=await q(t,r),n=s.getItem(a);if(n)return JSON.parse(n)};let e=a=>{};return{get:i,set:async(a,{merge:n=!1}={})=>{var E;const u=await q(t,r);n&&(a=Object.assign((E=await i())!=null?E:{},a)),s.setItem(u,JSON.stringify(a))},remove:async()=>s.removeItem(await q(t,r)),on:a=>{e!=a&&(e=a),window.addEventListener("storage",e)},off:()=>{window.removeEventListener("storage",e)}}},O=()=>new Date().getTime(),M=async t=>await F(`reg.${t}`,sessionStorage),tt="secret",bt=async t=>{const s=await M(t),r=await s.get();if(r&&O()-r.ts>=86400*1e3){s.remove();return}return r},Q=async t=>(await M(t)).remove(),yt=async(t,s=tt,r=[])=>{const i=await M(t),e=await i.get();if(e)return e;const n={secret:await(await W()).makeCommitment(X(t),await H(),Z(s),r),ts:O()};return await i.set(n,{merge:!0}),n},wt=async t=>{const s=await yt(t),r=await W(),[i,e]=["commit",{}],a=[s.secret];await U(e,r,i,a);const n=r[i](...a),u=await M(t);return new z(n,{errorCodes:"Resolver",seq:{type:"commit",title:"Commit",ts:O(),overrides:e},onSent:()=>u.set({ts:O()},{merge:!0}),onSuccess:()=>u.set({ts:O()},{merge:!0}),onError:()=>u.remove()})},vt=async(t,s=tt,r=[])=>{const i=await W(),[e,a]=["register",{}],n=[X(t),await H(),Z(s),r];await U(a,i,e,n);const u=i[e](...n);return new z(u,{errorCodes:"Resolver",seq:{type:"register",title:"Register",ts:O(),overrides:a}})},xt="";var $t=Object.defineProperty,St=Object.getOwnPropertyDescriptor,et=(t,s,r,i)=>{for(var e=i>1?void 0:i?St(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&$t(s,r,e),e};let Y=class extends w(xt){constructor(){super(...arguments),this.bindBridge=new T(this,b)}get bridge(){return b.bridge}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return o`<dui-link class="uri mt-4" href="${this.txScanUri}" target="_blank" rel="noopener">View Transaction: ${it(this.tx.hash)}</dui-link>`}};et([d({type:Object})],Y.prototype,"tx",2);Y=et([v("tx-view")],Y);const Ot=`.tx-state{display:flex;flex-direction:column;align-items:center;flex-grow:1}.tx-state-icon.success{color:green}.tx-state-icon.failed{color:red}.tx-state-icon.warn{color:orange}.tx-state-msg{word-break:break-word;white-space:normal}
`;var _t=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,A=(t,s,r,i)=>{for(var e=i>1?void 0:i?Ct(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&_t(s,r,e),e};let D=class extends w(Ot){constructor(){super(),this.bindBridge=new T(this,b),this.txType=!1,this.onlyAwaitHash=!1,this.opts={}}get bridge(){return b.bridge}get icons(){var e;const[t='<i class="mdi mdi-check-all"></i>',s='<i class="mdi mdi-check"></i>',r='<i class="mdi mdi-close"></i>',i='<i class="mdi mdi-loading"></i>']=(e=this.opts.icons)!=null?e:[];return{success:t,failed:r,wait:i,almostSuccess:s}}get hashOk(){return this.onlyAwaitHash&&this.tx.hash}get state(){var e,a,n;let[t,s,r]=["","",""];const{state:i}=this.opts;switch(this.tx.status){case-1:[t,s,r]=[this.icons.wait,(i==null?void 0:i.wait)||"Waiting for confirmation...","wait"];break;case 0:[t,s,r]=[this.icons.failed,(a=(e=this.tx.err)==null?void 0:e.message)!=null?a:"Something went wrong","failed"];break;case 1:[t,s,r]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"];break;case 2:[t,s]=[this.icons.wait,"Confirm the transaction."];break;case 4:[t,s,r]=[this.icons.almostSuccess,((n=this.tx.err)==null?void 0:n.message)||"Almost Success","warn"];break}return this.hashOk&&([t,s,r]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"]),{icon:t,txt:s,css:r}}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return o`<div class="tx-state m-4"><div class="tx-state-icon my-3 text-3xl mx-auto ${this.state.css}">${l(this.tx.pending&&!this.hashOk,()=>o`<slot name="pending"><i class="mdi mdi-loading"></i></slot>`,()=>o`<span>${gt(this.state.icon)}</span>`)}</div><div class="tx-state-msg my-4"><slot>${this.state.txt}</slot></div><div class="flex gap-4">${l(this.tx.hash,()=>o`${l(this.tx.success||this.tx.almostSuccess,()=>o`<slot name="view"><tx-view .tx="${this.tx}"></tx-view></slot>`,()=>o`<tx-view .tx="${this.tx}"></tx-view>`)}`)}</div></div>`}};A([d({type:Object})],D.prototype,"tx",2);A([d({type:Boolean})],D.prototype,"txType",2);A([d({type:Boolean})],D.prototype,"onlyAwaitHash",2);A([d({type:Object})],D.prototype,"opts",2);D=A([v("tx-state")],D);var Pt=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,k=(t,s,r,i)=>{for(var e=i>1?void 0:i?Dt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Pt(s,r,e),e};const Tt=async t=>{const s=await rt("Locker",{account:await H()}),[r,i,e]=["claimDoid",{},[+t]];await U(i,s,r,e);const a=s[r](...e);return new z(a,{errorCodes:"Locker",seq:{type:"claim-name",title:"Claim Name",ts:new Date().getTime(),overrides:i}})};let _=class extends w(""){constructor(){super(...arguments),this.bindBridge=new T(this,b),this.sm=!1,this.tx=null,this.success=!1,this.dialog=!1,this.claim=async()=>{try{this.tx=await Tt(+this.passId),this.success=await this.tx.wait()}catch(t){if(t.code===4001)return this.close()}}}get name(){var t;return(t=this.nameInfo)==null?void 0:t.name}get passId(){var t;return((t=this.nameInfo)==null?void 0:t.id)||0}get txPending(){var t;return this.tx&&!((t=this.tx)!=null&&t.ignored)}close(t=!1){this.dialog=!1,this.tx=void 0,t&&this.emit("success"),this.emit("show",!1)}open(){this.dialog=!0,this.emit("show",!0)}render(){return o`<dui-button ?disabled="${this.dialog}" ?pending="${this.dialog}" class="success" @click="${this.open}" ?sm="${this.sm}"><slot>Claim</slot></dui-button>${l(this.dialog,()=>{var t;return o`<dui-dialog @close="${()=>this.close()}"><div slot="header">Claim DOID name</div><div class="min-h-10">${l(!((t=this.tx)!=null&&t.success),()=>o`<div class="text-center">You are claiming for:<p class="text-black my-4 text-lg"><b class="text-blue-600">${this.name}</b>.doid</p><p>${o`(Note: This pass <b class="text-base text-orange-500">#${this.passId}</b> will be burned after claiming.)`}</p></div>`)} ${l(this.txPending,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:`Success. You are the registrant of ${this.name} now`}}}"><dui-button slot="view" @click="${()=>this.close(!0)}">Close</dui-button></tx-state>`,()=>o`<p class="mt-8 text-center"><dui-button class="success" @click="${this.claim}">Continue</dui-button></p>`)}</div></dui-dialog>`})}`}};k([d({type:Object})],_.prototype,"nameInfo",2);k([d({type:Boolean})],_.prototype,"sm",2);k([c()],_.prototype,"tx",2);k([c()],_.prototype,"success",2);k([c()],_.prototype,"dialog",2);_=k([v("doid-claim-name")],_);const kt=`.per{background:linear-gradient(90deg,rgba(96,184,100,1) 0%,rgba(76,175,80,1) 100%)}
`;var It=Object.defineProperty,jt=Object.getOwnPropertyDescriptor,S=(t,s,r,i)=>{for(var e=i>1?void 0:i?jt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&It(s,r,e),e};let x=class extends w(kt){constructor(){super(...arguments),this.percent=0,this.randomTo=0,this.precision=2,this.label=!1,this.state=!1,this.pending=!1,this.randomProgress=this.randomTo,this.randomTimer=null}get progress(){return Math.min(this.percent,100)}get per(){return(this.randomTo?Math.max(this.progress,this.randomProgress):this.progress).toFixed(this.precision)}shouldUpdate(t){return t.has("randomTo")&&(this.randomTo?(this.randomProgress=this.percent,this.randomTimer=setInterval(()=>{this.randomProgress+=Math.floor(Math.random()*(.2-.1+1)+.1),this.randomProgress>=this.randomTo&&clearInterval(this.randomTimer)},200)):clearInterval(this.randomTimer)),!0}render(){return o`<div class="relative flex grow w-full items-center"><div class="bar bg-gray-300 relative block w-full h-1.5 overflow-hidden rounded-full"><p class="per pr-1 absolute top-0 h-full rounded-full transition-all bg-green-600" style="${ut({width:`${this.per}%`})}"></p></div></div>`}};S([d({type:Number})],x.prototype,"percent",2);S([d({type:Number})],x.prototype,"randomTo",2);S([d({type:Number})],x.prototype,"precision",2);S([d({type:Boolean})],x.prototype,"label",2);S([d({type:Boolean})],x.prototype,"state",2);S([c()],x.prototype,"pending",2);S([c()],x.prototype,"randomProgress",2);S([c()],x.prototype,"randomTimer",2);x=S([v("progress-bar")],x);const Rt=`ol{margin-top:1rem;margin-bottom:1rem;display:grid;grid-gap:1rem;gap:1rem}@media (min-width: 768px){ol{grid-template-columns:repeat(3,minmax(0,1fr))}}ol li{position:relative;display:inline-flex;flex-direction:column;gap:.5rem;border-radius:.375rem;border-width:1px;--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity));padding:1.25rem 1rem 1rem 3.5rem}ol li:before{position:absolute;left:.75rem;top:.75rem;display:flex;height:2rem;width:2rem;align-items:center;justify-content:center;border-radius:9999px;border-width:1px;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-weight:700}ol li.active,ol li.done{border-style:dashed;--tw-border-opacity: 1;border-color:rgba(156,163,175,var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgba(226,232,240,var(--tw-bg-opacity))}ol li.active:before,ol li.done:before{--tw-border-opacity: 1;border-color:rgba(148,163,184,var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgba(248,250,252,var(--tw-bg-opacity))}ol li.done{border-color:transparent}ol li.done:before{--tw-border-opacity: 1;border-color:rgba(22,163,74,var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgba(240,253,244,var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgba(22,163,74,var(--tw-text-opacity))}ol li>b{display:block}ol li>p{line-height:1.375}ol li:nth-child(1):before{content:"1"}ol li:nth-child(2):before{content:"2"}ol li:nth-child(3):before{content:"3"}
`;var At=Object.defineProperty,Et=Object.getOwnPropertyDescriptor,g=(t,s,r,i)=>{for(var e=i>1?void 0:i?Et(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&At(s,r,e),e};let p=class extends w(Rt){constructor(){super(...arguments),this.name="",this.done=!1,this.pending=!1,this.err="",this.ts=0,this.step=1,this.tx=null,this.commitment={},this.cd=0,this.timer=null,this.goStep2=()=>{this.step=2;const t=60;this.cd=t,this.timer=setInterval(()=>{--this.cd<=0&&this.goStep3()},1e3)},this.goStep3=()=>{this.step=3,clearInterval(this.timer)},this.getCommitment=async()=>{this.commitment=await bt(this.name)||{}},this.get=async()=>{await this.getCommitment();const{secret:t,ts:s}=this.commitment;s&&O()-s>60*1e3?this.goStep3():t&&this.goStep2(),this.ts++},this.commit=async()=>{this.pending=!0,this.err="";try{this.tx=await wt(this.name),await this.tx.wait(),this.goStep2()}catch(t){t.code!==4001&&/( IC)/.test(t.message)&&(this.err="This name is already committed by someone else, please try again later"),Q(this.name),this.tx=null}finally{this.pending=!1}},this.register=async()=>{if(this.done)return N(`/name/${this.name}/details`);if(this.step!==3)return this.commit();this.pending=!0,this.err="";try{this.tx=await vt(this.name),this.done=await this.tx.wait(),Q(this.name)}catch(t){t.code!==4001&&(this.err=t.message),this.tx=null}finally{this.pending=!1}},this.go2success=()=>{N(this.detailsLink)}}get btn(){return{disabled:this.err||this.pending||this.step===2,title:this.done?"Manage name":this.step>1?"Register":"Request to Register"}}get txSuccess(){return this.tx&&!this.tx.ignored}get lockedByMe(){const{locked:t,itsme:s}=this.nameInfo;return t&&s}get detailsLink(){return`/name/${this.name}/details`}get txPending(){var t;return this.tx&&!((t=this.tx)!=null&&t.ignored)}get percent(){if(this.done)return 100;if(this.step===1){if(this.pending&&!this.tx)return 2;if(this.tx)return 5}if(this.step===2)return 35;if(this.step===3){if(this.pending&&!this.tx)return 70;if(this.tx)return 75}return this.step===3?68:0}get randomTo(){return this.step===1&&this.tx?35:this.step===2?68:this.step===3&&this.tx?99:0}connectedCallback(){super.connectedCallback(),this.get()}render(){return this.nameInfo.available?this.lockedByMe?o`<div class="px-3"><h3 class="text-base mb-4">${`This DOID name is already locked by pass #${this.nameInfo.locked}`}</h3><doid-claim-name @success="${this.go2success}" .nameInfo="${this.nameInfo}">Claim this name</doid-claim-name></div>`:o`<div class="px-3"><h3 class="text-base">${this.done?"You’ve completed all the steps, manage your name now!":"Registering a name requires you to complete 3 steps"}</h3><ol><li class="${f({done:this.done||this.step>1,active:this.step>=1})}"><b>Request to register</b><p>Your wallet will open and you will be asked to confirm the first of two transactions required for registration. If the second transaction is not processed within 7 days of the first, you will need to start again from step 1.</p></li><li class="${f({done:this.done||this.step>2,active:this.step>=2})}"><b>Wait for ${this.cd?`${this.cd} seconds`:"1 minute"}</b><p>The waiting period is required to ensure another person hasn’t tried to register the same name and protect you after your request.</p></li><li class="${f({done:this.done,active:this.step>=3})}"><b>Complete Registration</b><p>Click ‘register’ and your wallet will re-open. Only after the 2nd transaction is confirmed you'll know if you got the name.</p></li></ol><progress-bar .percent="${this.percent}" .randomTo="${this.randomTo}" class="my-4"></progress-bar><div class="my-4 flex justify-center items-center h-9"><dui-button @click="${this.register}" ?disabled="${this.btn.disabled}" class="${f({secondary:this.done})}" ?pending="${this.pending}">${this.btn.title}${l(this.cd,()=>o`<span class="ml-2">(${this.cd})</span>`,()=>o`<i class="mdi ml-2 ${f(this.$c([this.pending?"mdi-loading":"mdi-chevron-right"]))}"></i>`)}</dui-button></div><div class="text-center">${l(this.done,()=>o`<p class="text-green-600">Success!</p>`)} ${l(this.err,()=>o`<p class="text-red-500">${this.err}</p>`)}</div></div>`:o`${l(this.nameInfo.itsme,()=>o`<div class="px-3"><dui-button class="secondary" href="${this.detailsLink}">Manage your name <i class="mdi mdi-chevron-right"></i></dui-button></div>`,()=>o`<div class="px-3">This DOID name is already taken.<dui-link class="mx-1" href="${this.detailsLink}">See Details</dui-link></div>`)}`}};g([d()],p.prototype,"name",2);g([d({type:Object})],p.prototype,"nameInfo",2);g([c()],p.prototype,"done",2);g([c()],p.prototype,"pending",2);g([c()],p.prototype,"err",2);g([c()],p.prototype,"ts",2);g([c()],p.prototype,"step",2);g([c()],p.prototype,"tx",2);g([c()],p.prototype,"commitment",2);g([c()],p.prototype,"cd",2);g([c()],p.prototype,"timer",2);p=g([v("view-name-register")],p);const Bt=`.card{position:relative;display:flex;flex-direction:column;gap:1rem;--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity));padding:1.25rem 1rem 1rem 3.5rem}.card:before{position:absolute;left:.75rem;top:.75rem;display:flex;height:2rem;width:2rem;align-items:center;justify-content:center;border-radius:9999px;border-width:1px;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));font-weight:700;content:attr(idx)}.card.active,.card.done{--tw-bg-opacity: 1;background-color:rgba(226,232,240,var(--tw-bg-opacity))}.card.active:before,.card.done:before{--tw-border-opacity: 1;border-color:rgba(148,163,184,var(--tw-border-opacity))}.card.done{border-color:transparent}.card.done:before{--tw-border-opacity: 1;border-color:rgba(22,163,74,var(--tw-border-opacity));--tw-bg-opacity: 1;background-color:rgba(240,253,244,var(--tw-bg-opacity));--tw-text-opacity: 1;color:rgba(22,163,74,var(--tw-text-opacity))}
`;var Mt=Object.defineProperty,qt=Object.getOwnPropertyDescriptor,G=(t,s,r,i)=>{for(var e=i>1?void 0:i?qt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Mt(s,r,e),e};let B=class extends w(Bt){constructor(){super(...arguments),this.class="",this.index=1}connectedCallback(){super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback()}render(){return o`<div class="card h-full ${f(this.$c([this.class]))}" idx="${this.index}"><slot name="title" part="step-title"></slot><slot name="description" part="step-desc"></slot></div>`}};G([d({type:String})],B.prototype,"class",2);G([d({type:String})],B.prototype,"index",2);B=G([v("dui-card")],B);var Nt=Object.defineProperty,Lt=Object.getOwnPropertyDescriptor,st=(t,s,r,i)=>{for(var e=i>1?void 0:i?Lt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Nt(s,r,e),e};let V=class extends w(at){constructor(){super(...arguments),this.model=!1}async close(){this.model=!1,await nt(200),this.remove(),this.emit("close")}render(){return setTimeout(()=>{this.model=!0}),o`<div part="dialog-container" class="relative !origin-center z-10 bg-white rounded-xl drop-shadow-lg ${this.model?"-mt-8 opacity-100 visible":"-mt-80 opacity-0 invisible"}" ${K({guard:()=>this.model,properties:["opacity","visibility","margin","transform"],keyframeOptions:{duration:233}})}><slot name="top"><i part="dialog-close" class="absolute flex justify-center items-center right-4 top-4 w-6 h-6 text-2xl cursor-pointer" @click="${this.close}"><i class="mdi mdi-close"></i></i><div part="dialog-header" class="w-full p-4 pr-8 flex justify-between items-center text-base"><slot name="header"></slot></div></slot><slot name="center"><div part="dialog-body" class="p-4"><slot></slot></div></slot><slot name="bottom"><div part="dialog-footer" class="p-4"><slot name="footer"></slot></div></slot></div><div part="dialog-overlay" class="z-0 absolute left-0 top-0 w-full h-full visible bg-black bg-opacity-75 ${this.model?"opacity-75":"opacity-0"}" ${K({guard:()=>this.model})}></div>`}};st([c()],V.prototype,"model",2);V=st([v("dui-prompt")],V);const Yt=`:host::part(dialog-container){min-height:40px}
`;var Vt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,m=(t,s,r,i)=>{for(var e=i>1?void 0:i?Ut(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Vt(s,r,e),e};let h=class extends w(Yt){constructor(){super(...arguments),this.bindBridge=new T(this,b),this.owner=!1,this.coin={},this.name="",this.currentAddr="",this.step=1,this.signatureInfo={},this.pending=!1,this.err="",this.stored={},this.tx=null,this.success=!1,this.dialog=!1,this.showTip=()=>{this.dialog=!0},this.close=()=>{this.dialog=!1},this.getStorage=async()=>await F(`sign.${this.name}`,sessionStorage,!0),this.getStoredInfo=async()=>{var r;const s=await(await this.getStorage()).get();this.stored=s,(r=this.stored)!=null&&r.signature&&(this.step=2)},this.getSignerMessage=async()=>{const t=this.account,s=this.coin.coinType,r=await dt(this.name,t,s),i=await this.getStorage(),e={...this.stored,...r};i.set(e),this.stored=e},this.signMessage=async()=>{const t=await this.getStorage(),s=await lt(this.msg),r={...this.stored,...s};t.set(r),this.stored=r},this.sign=async()=>{if(!(!this.name||!this.ownerAddress||!this.coin.coinType||!this.account||!this.msg)&&!this.isCurrentEqualToDest){this.pending=!0,this.err="";try{await this.signMessage(),this.step=2}catch(t){if(t.code===4001)return;this.err=t.message}finally{this.pending=!1}}},this.setAddr=async()=>{if(this.pending)return;this.pending=!0,this.err="",this.success=!1;const{name:t,coinType:s,dest:r,timestamp:i,nonce:e,signature:a}=this.stored,n=await this.getStorage();try{this.tx=await ht(t,s,r,+i,e,a);const u=await this.tx.wait();n.remove(),this.success=u,this.step=3,this.emit("success")}catch(u){this.err=u.message}finally{this.pending=!1,n.remove()}},this.disconnectedCallback=()=>{super.disconnectedCallback(),this.step=1,this.dialog=!1}}get ownerAddress(){return this.stored.source}get dest(){return this.stored.dest}get msg(){return this.stored.message||""}get cookedMsg(){return this.msg.split(`
`).map(t=>{const s=(t.match(/^(.+:\s)/)||[])[0]||"";return{title:s,content:t.replace(s,"")}})}get account(){return b.bridge.account}get coinType(){return this.coin.coinType}get isStep1(){return this.step===1}get signature(){var t;return this.stored.signature||((t=this.signatureInfo)==null?void 0:t.signature)}get txPending(){var t;return this.tx&&!((t=this.tx)!=null&&t.ignored)}get isCurrentEqualToDest(){var t;return this.currentAddr===((t=this.dest)==null?void 0:t.toLowerCase())}get btnSignDisabled(){return this.currentAddr?this.pending||this.err||this.isCurrentEqualToDest||this.txPending:!1}get btnSetDisabled(){return this.pending||this.err||!this.signature||!this.owner||this.txPending}async connectedCallback(){super.connectedCallback(),await this.getStoredInfo(),!(this.dest==this.account||this.signature)&&await this.getSignerMessage()}render(){return o`<div class="set-record border border-gray-300 border-dashed pt-2 pb-5 mt-2"><div class="px-3"><div class="border-b-2 flex my-4 px-3 pr-4 space-x-4 justify-between"><div>You are setting <b>${this.coin.name}</b> address to <b class="break-words break-all">${this.dest}</b></div>${l(this.isStep1,()=>o`<div @click="${this.showTip}"><a href="javascript:void(0)" class="text-blue-400">Change address to set</a></div>${l(this.dialog,()=>o`<dui-prompt class="min-h-fit" @close="${this.close}"><div class="text-base">Open your wallet and switch to the address you want to set.</div><span slot="bottom"></span></dui-prompt>`)}`)}</div><div>${l(this.pending&&!this.ownerAddress,()=>o``,()=>o`<div class="px-3"><h3 class="text-base">Setting an address requires you to complete 2 steps</h3><div class="grid md_grid-cols-2 gap-4 my-4"><dui-card index="1" class="rounded-md ${f({done:this.step>1,active:this.step>=1})}"><div slot="title"><b>SIGN A MESSAGE TO VERIFY YOUR ADDRESS</b></div><div slot="description" class="flex flex-col gap-2"><p>Your wallet will open and following message will be shown:</p><div class="break-words break-all">${l(this.msg,()=>o`<span class="text-gray-500">Message:</span> ${L(this.cookedMsg,t=>o`<p><b>${t.title}</b>${t.content}</p>`)}`)}</div></div></dui-card><dui-card index="2" class="rounded-md ${f({done:this.step>2,active:this.step>=2})}"><div slot="title"><b>Complete Setting</b></div><div slot="description" class="flex flex-col gap-2"><p class="break-words">You need to change your wallet back to ${l(!this.owner&&!this.isStep1,()=>o`${this.ownerAddress}`,()=>o`the address`)} that owns <b>${this.name}</b></p><p>Click 'set' and your wallet will re-open. Only after the transaction is confirmed your address will be set.</p></div></dui-card></div><div class="mt-4 text-center">${l(this.isStep1,()=>o`<dui-button sm @click="${this.sign}" ?disabled="${this.btnSignDisabled}" ?pending="${this.pending}">Sign message<i class="mdi ml-2 ${f(this.$c([this.pending?"mdi-loading":"mdi-chevron-right"]))}"></i></dui-button>`,()=>o`<dui-button sm @click="${this.setAddr}" ?disabled="${this.btnSetDisabled}" ?pending="${this.pending}">Set<i class="mdi ml-2 ${f(this.$c([this.pending?"mdi-loading":""]))}"></i></dui-button>`)}</div></div>`)}</div></div></div>`}};m([d({type:Boolean})],h.prototype,"owner",2);m([d({type:Object})],h.prototype,"coin",2);m([d({type:String})],h.prototype,"name",2);m([d({type:String})],h.prototype,"currentAddr",2);m([c()],h.prototype,"step",2);m([c()],h.prototype,"signatureInfo",2);m([c()],h.prototype,"pending",2);m([c()],h.prototype,"err",2);m([c()],h.prototype,"stored",2);m([c()],h.prototype,"tx",2);m([c()],h.prototype,"success",2);m([c()],h.prototype,"dialog",2);h=m([v("doid-set-record-wallet")],h);const Ht=`.edit{margin-top:0;margin-bottom:0}.edit .addr_edit{width:14rem}@media (min-width: 1024px){.edit .addr_edit{width:24rem}}
`;var Wt=Object.defineProperty,zt=Object.getOwnPropertyDescriptor,$=(t,s,r,i)=>{for(var e=i>1?void 0:i?zt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Wt(s,r,e),e};let y=class extends w(Ht){constructor(){super(...arguments),this.bindBridge=new T(this,b),this.item={},this.owner=!1,this.name="",this.tip={addr:""},this.err={addr:"",tx:""},this.pending=!1,this.addrValid=!1,this.mode="",this.stored={},this.storage={},this.listener=t=>{this.reset()},this.reset=(t=!1)=>{this.mode="",this.stored={},t&&this.storage.remove()},this.setAddr=async()=>{if(this.isEditing)return this.reset(!0);R.emit("addr-edit"),this.mode="edit",this.storage.set({...this.coinType,source:this.address||this.account}),ot(),await this.checkEditInfo()},this.onSuccess=t=>{this.reset(),this.emit("success")},this.disconnectedCallback=async()=>{super.disconnectedCallback(),this.reset(),R.off("addr-edit",this.listener),this.storage.off()}}get account(){return b.bridge.account}get isOwner(){return this.owner==!0}get isEditing(){return this.mode==="edit"||this.isStored}get isStored(){var t,s;return!!((t=this.stored)!=null&&t.source)&&((s=this.stored)==null?void 0:s.coinType)===this.coinType.coinType}get editDisabled(){return this.pending}get address(){return this.item.address}get coinType(){return{name:this.item.name,coinType:this.item.coinType}}async checkEditInfo(){const t=await this.storage.get();this.stored=t}async connectedCallback(){super.connectedCallback(),this.storage=await F(`sign.${this.name}`,sessionStorage,!0),await this.checkEditInfo(),R.on("addr-edit",this.listener),this.storage.on(this.listener)}render(){return o`<div class="flex items-center ${this.mode}"><div class="addr_name w-14 lg_w-16 text-gray-400">${this.coinType.name}</div><div class="grow flex items-center">${l(this.address,()=>o`<dui-address avatar copy .address="${this.address}"></dui-address>`,()=>o`<span class="text-gray-400">No set</span>`)} ${l(this.isOwner,()=>o`<dui-button @click="${this.setAddr}" sm icon class="ml-1" .disabled="${this.editDisabled}"><i class="mdi ${f({"mdi-pencil-off-outline":this.isEditing,"mdi-pencil-outline":!this.isEditing})}"></i></dui-button>`)}</div></div>${l(this.isEditing,()=>o`<doid-set-record-wallet .name="${this.name}" .coin="${this.coinType}" .owner="${this.isOwner}" .currentAddr="${this.address}" @success="${this.onSuccess}"></doid-set-record-wallet>`)}`}};$([d({type:Object})],y.prototype,"item",2);$([d({type:Boolean})],y.prototype,"owner",2);$([d({type:String})],y.prototype,"name",2);$([c()],y.prototype,"tip",2);$([c()],y.prototype,"err",2);$([c()],y.prototype,"pending",2);$([c()],y.prototype,"addrValid",2);$([c()],y.prototype,"mode",2);$([c()],y.prototype,"stored",2);y=$([v("doid-addr-item")],y);const Ft=`.infos:not(:first-child){margin-top:.5rem;border-top-width:1px;border-style:dashed;--tw-border-opacity: 1;border-color:rgba(209,213,219,var(--tw-border-opacity));padding-top:.5rem}.infos>li{display:flex;gap:1rem;padding-top:.5rem;padding-bottom:.5rem}.infos>li>strong{display:block;width:8rem;flex-shrink:0;font-weight:500;text-transform:uppercase}@media (min-width: 1024px){.infos>li>strong{width:9rem}}.infos>li .info-cnt{flex-shrink:1}.infos>li.single{align-items:center;padding-top:0;padding-bottom:0}.infos>li.single .info-cnt{display:flex;align-items:center}.infos>li.wrap{flex-wrap:wrap}@media (min-width: 1024px){.infos>li.wrap{flex-wrap:nowrap}}.infos>li.wrap>storng{width:100%}@media (min-width: 768px){.infos>li.wrap>storng{width:8rem}}@media (min-width: 1024px){.infos>li.wrap>storng{width:9rem}}
`;var Gt=Object.defineProperty,Jt=Object.getOwnPropertyDescriptor,I=(t,s,r,i)=>{for(var e=i>1?void 0:i?Jt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Gt(s,r,e),e};let C=class extends w(Ft){constructor(){super(...arguments),this.bindBridge=new T(this,b),this.name="",this.pending=!1,this.ts=0,this.records=[],this.fetchRecords=async()=>{this.pending=!0;try{this.records=await pt(this.info.name)}catch(t){}this.pending=!1,this.ts++},this.onSuccess=()=>{this.fetchRecords()}}get account(){return b.bridge.account}get empty(){var t;return this.ts&&!((t=this.records)!=null&&t.length)}get details(){const t=this.info.owner;return[{title:"Registrant",address:t},{title:"Controller",address:t}].map(s=>(s.link=`/address/${s.address}`,s))}connectedCallback(){super.connectedCallback(),this.fetchRecords()}render(){return o`<div class="px-3"><ul class="infos">${L(this.details,t=>o`<li class="single"><strong>${t.title}</strong><div class="info-cnt"><dui-address avatar copy .address="${t.address}" href="${t.link}"></dui-address></div></li>`)}</ul><ul class="infos"><li class="wrap"><strong>Addresses</strong><div class="info-cnt">${l(!this.ts&&this.pending,()=>o`<i class="mdi mdi-loading"></i>`)} ${l(this.empty,()=>o`<p class="text-red-500">Something went wrong</p>`,()=>o`<div class="doid-addr-items -mt-1 flex justify-start items-start flex-col gap-4"></div>${L(this.records,t=>o`${ft(t.address,o`<doid-addr-item key="${t.coinType}" .item="${t}" .name="${this.name}" .owner="${this.info.itsme}" @success="${this.onSuccess}"></doid-addr-item>`)}`)}`)}</div></li></ul></div>`}};I([d({type:Object})],C.prototype,"info",2);I([d({type:String})],C.prototype,"name",2);I([c()],C.prototype,"pending",2);I([c()],C.prototype,"ts",2);I([c()],C.prototype,"records",2);C=I([v("view-name-details")],C);const Kt=`:host::part(dui-nav){display:flex;margin-bottom:-2px}
`;var Qt=Object.defineProperty,Xt=Object.getOwnPropertyDescriptor,j=(t,s,r,i)=>{for(var e=i>1?void 0:i?Xt(s,r):s,a=t.length-1,n;a>=0;a--)(n=t[a])&&(e=(i?n(s,r,e):n(e))||e);return i&&e&&Qt(s,r,e),e};let P=class extends w(Kt){constructor(){super(...arguments),this.name="",this.action="",this.pending=!1,this.disconnected=!1,this.nameInfo=null,this.goto=()=>{ct(`/name/${J(this.name)}/${this.action}`)},this.check=async(t,s=!1)=>{if(this.pending||await this.isDisconnected(s))return;this.pending=!0;const r=J(this.name);if(this.name!==r)this.name=r;else try{if(await this.isDisconnected(!0)||(this.nameInfo=await mt(this.name),await this.isDisconnected(!0)))return;this.action||(this.action=this.nameInfo.available?"register":"details")}catch(i){this.nameInfo=null}this.goto(),this.pending=!1}}get inReg(){return this.nameInfo&&!this.pending&&this.action==="register"}get inDetails(){return this.nameInfo&&!this.pending&&this.action==="details"}get empty(){return!this.name}connectedCallback(){super.connectedCallback(),this.check(null,!0),R.on("router-change",this.check)}disconnectedCallback(){super.disconnectedCallback(),R.off("router-change",this.check)}render(){return o`<div class="view-name"><div class="dui-container"><dui-ns-search .text="${this.name}" @search="${t=>N(`/search/${t.detail}`)}" placeholder="Search names"><span slot="label"></span> <span slot="msgd"></span></dui-ns-search>${l(this.name,()=>o`<div class="border-b-2 flex my-4 px-3 pr-4 justify-between items-end"><div><b class="text-lg">${this.name}</b> ${l(this.name==="doid",()=>o`<em>(Registrant)</em>`)}</div><div><dui-nav slot="center" part="dui-nav"><dui-link href="${`/name/${this.name}/register`}" alias="${`/name/${this.name}`}" exact nav>Register</dui-link><dui-link href="${`/name/${this.name}/details`}" exact nav>Details</dui-link></dui-nav></div></div>`)} ${l(this.pending,()=>o`<i class="mdi mdi-loading"></i> Loading...`)} ${l(this.inReg,()=>o`<view-name-register .name="${this.name}" .nameInfo="${this.nameInfo}"></view-name-register>`)} ${l(this.inDetails,()=>o`<view-name-details .name="${this.name}" .info="${this.nameInfo}"></view-name-details>`)}</div></div>`}};j([d()],P.prototype,"name",2);j([d()],P.prototype,"action",2);j([c()],P.prototype,"pending",2);j([c()],P.prototype,"disconnected",2);j([c()],P.prototype,"nameInfo",2);P=j([v("view-name")],P);export{P as ViewName};
