import{a as K,b as D,u as J,c as G,n as W,e as P,_ as X,d as E,f as M,h as w,i as Y,j as Z,k as tt,l as et,w as N,m as j,g as st,T as k}from"./index-d8b7be2e.js";import{p as b,S as F,x as V,B as it,z as rt,y as f,k as y,m as u,e as C,A as nt,b as L,D as at,n as ot}from"./vendor-7fa7464a.js";const v=async()=>K("Resolver");var lt=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,ut=(s,e,i,r)=>{for(var t=r>1?void 0:r?ct(e,i):e,n=s.length-1,a;n>=0;n--)(a=s[n])&&(t=(r?a(e,i,t):a(t))||t);return r&&t&&lt(e,i,t),t};class U extends F{constructor(e){super(),this.key="",this.key=e}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}ut([b({value:[]})],U.prototype,"queue",2);const dt=7200*1e3;class ht{constructor(e){this.provider=J().bridgeStore.bridge.provider,this.store=new U(`evm.txs.${e||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(e){if(!e.chainId){const{network:i}=this.provider;e.chainId=i.chainId,e.scan=i.scan}e.pending=!0,this.queue.unshift(e),this.store.save(),this.provider.nonce=+e.nonce+1}delDelay(e,i=0){setTimeout(()=>this.del(e),i)}del(e){var r,t;const i=(t=(r=e.hash)!=null?r:e.ts)!=null?t:e;this.queue.some((n,a)=>{if([n.hash,n.ts,n].includes(i)){a===0&&(this.provider.nonce=0);const o=this.queue.splice(a,1);return this.store.save(),o}})}async check(e){this.queue.forEach(async(i,r)=>{if(e&&r===0){const t=await G(this.provider.account),n=+i.nonce;this.provider.nonce=n>t?n+1:t}if(i.done||new Date().getTime()-i.ts>=dt)return this.del(i);if(!i.err&&!(!e&&i.pending)){i.pending=!0;try{const t=await this.provider.waitForTransaction(i.hash),{status:n}=t;i.status=n,n===1?(i.done=!0,this.del(i)):i.err=!0}catch(t){i.err=t}i.pending=!1}}),this.store.save()}}const q={},O=(s=D.bridge.account)=>q[s]||(q[s]=new ht(s)),pt=async s=>s?typeof s=="object"?s:await X(Object.assign({"./abi/Locker.codes.json":()=>E(()=>import("./Locker.codes-d3f42ed5.js"),[]),"./abi/Resolver.codes.json":()=>E(()=>import("./Resolver.codes-ee4f74d3.js"),[])}),`./abi/${s}.codes.json`):{};class gt{constructor(e,{errorCodes:i="",seq:r=void 0,delay:t=0,allowAlmostSuccess:n=!1,onSent:a=()=>{},onSuccess:o=()=>{},onError:l=()=>{}}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=n,this.txPromise=e,this.err=void 0,this.hash="",this.errorCodes=i,this.seq=r,this.delay=t,this.onSent=a,this.onSuccess=o,this.onError=l}get success(){return this.status===1}get processing(){return this.status===2}get almostSuccess(){return this.status===4}get ignored(){return this.status===3}async wait(e=!1){return(async()=>{let i=!1;const r=await pt(this.errorCodes);try{const t=await this.txPromise;this.onSent(t);const{hash:n,nonce:a}=t;this.seq.nonce=a,this.seq&&(delete this.seq.overrides,O().add(Object.assign(this.seq,{hash:n}))),this.hash=n,this.status=2;const o=async()=>{const{status:l,events:h}=await t.wait(1);if(l!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");h.some(({event:m,args:R}={})=>{if(m==="Failure"){let{info:S,detail:_,error:$}=R;const A=$.toString(),T=r[$],H={code:A,message:T,error:$,info:S==null?void 0:S.toString(),detail:_==null?void 0:_.toString()};this.seq&&(this.seq.err=!0);const B=new Error(T);throw Object.assign(B,{code:A,raw:H}),this.allowAlmostSuccess&&(this.status=4),B}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?O().delDelay(n,this.delay):O().del(n)};e?(i=!0,o()):await o(),this.onSuccess(t)}catch(t){throw await W(t),t.code===4001?this.status=3:this.status!==4&&(this.status=0),this.err=t,this.onError(t),t}finally{this.pending=!1;const t=this.status===1;P.emit("tx-status",this.hash),t&&P.emit("tx-success",this.hash),i=t}return i})()}}const Q=(s,e={})=>{const i={...s,...e},{owner:r,status:t,account:n}=i,a=!!n&&r.toLowerCase()===n.toLowerCase(),o=t==="locked",l=t==="available"||a&&o,h=t==="registered";let m=o?"Locked by pass":l?"Available":"Unavailable";return h&&a&&(m="Registered"),{name:N(i.name),owner:r,available:l,registered:h,stat:m,status:t,itsme:a,id:V(i.id||0,0),locked:o}},mt=async(s,e)=>{const i=async r=>{e||(e=await M());const t=await v();r=N(r);const n={name:r,account:e};try{const a=await t.statusOfName(w(r));Object.assign(n,Q(a,n))}catch(a){}return n};return Array.isArray(s)?await Promise.all(s.map(i)):await i(s)},It=async(s,e)=>{e||(e=await M());const i=await v(),r=[];try{const t=await i.namesOfOwner(s);r.push(...t.map(n=>Q(n,{owner:s,account:e,status:"registered"})))}catch(t){}return r},Rt=async s=>{if(!s)return;let e=w(s),i=await v();const r=await i.nameHash(e),t=await i.addrs(r),n=await Y();return t.forEach(([a,o])=>{const l=V(a,0);n[l]&&(n[l].address=o)}),Object.values(n)},At=async(s,e,i)=>{let r=await v();const t=await Z(),n=w(s),a=await t.getBlockNumber(),o=(await t.getBlock(a)).timestamp,l=it.from(rt(32)),h=await r.makeAddrMessage(n,i,e,o,l);return{name:s,dest:e,timestamp:o,nonce:l._hex,message:h}},Tt=async s=>({signature:await(await tt()).signMessage(s)}),Bt=async(s,e,i,r,t,n)=>{let a=await v();const o="setAddr",l={},h=[w(s),e,i,+r,t,n];await et(l,a,o,h);const m=a[o](...h);return new gt(m,{errorCodes:"Resolver",allowAlmostSuccess:!0,seq:{type:"setAddr",title:`set Address ${i}`,ts:new Date().getTime(),overrides:l}})};var ft=Object.defineProperty,yt=Object.getOwnPropertyDescriptor,I=(s,e,i,r)=>{for(var t=r>1?void 0:r?yt(e,i):e,n=s.length-1,a;n>=0;n--)(a=s[n])&&(t=(r?a(e,i,t):a(t))||t);return r&&t&&ft(e,i,t),t};class x extends F{constructor(){super(...arguments),this.search=async e=>{this.pending=!0,this.names=[];const{address:i,name:r}=j(e,{allowAddress:!0,wrap:!0});if(i)return st(`/address/${i}`);if(r){const t=await mt([r]);this.names=[t[0]]}this.ts++,this.pending=!1}}get len(){return this.names.length}get empty(){return!this.pending&&!this.len}}I([b({value:!1})],x.prototype,"pending",2);I([b({value:[]})],x.prototype,"names",2);I([b({value:0})],x.prototype,"ts",2);const vt=new x,wt=function(s={}){return this.inputNameRef||console.error("Please ref(this.inputNameRef) first"),this.validateDOIDName=e=>{this._checked={};const i=isNaN(this.nameMinLen)?s.len:this.nameMinLen,r=j(e.detail,{...s,len:i}),{name:t="",address:n="",error:a,msg:o}=r;return this.name=s.allowAddress?t||n:t,a?{error:a,msg:o}:((s.allowAddress&&n||t)&&(this.inputNameRef.value.$("input").value=this.name),this._checked=r,r)}},bt=`.dui-input-text{position:relative;margin-left:auto;margin-right:auto;display:flex;width:100%;padding-top:1.25rem;padding-bottom:1.25rem}.dui-input-text input[type]{font-family:var(--fontFamily);position:relative;display:inline-flex;width:100%;border-radius:.375rem;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity));padding:1.5rem .75rem;font-size:1rem;line-height:1.5rem;border:1px solid #ccc;height:2rem}.dui-input-text[disabled]{opacity:.6}.dui-input-text.sm input[type]{padding-top:1rem;padding-bottom:1rem;font-size:.875rem;line-height:1.25rem;height:1.5rem}.dui-input-text.sm .dui-input-right,.dui-input-text.sm .dui-input-left{line-height:1rem;padding-top:1rem;padding-bottom:1rem}.dui-input-text .dui-input-msg,.dui-input-text .dui-input-tip,.dui-input-text label{line-height:1!important}.dui-input-text .dui-input-msg,.dui-input-text .dui-input-tip,.dui-input-text label{position:absolute;display:flex;height:1rem;align-items:center;justify-content:center;padding-left:.75rem;padding-right:.75rem;font-size:.875rem;line-height:1.25rem;margin-left:1px;top:.15rem}.dui-input-text .dui-input-msg{top:auto;bottom:.15rem}.dui-input-text .dui-input-tip{left:auto;right:0px}.dui-input-text .dui-input-right,.dui-input-text .dui-input-left{position:absolute;display:flex;align-items:center;justify-content:center;border-top-right-radius:.375rem;border-bottom-right-radius:.375rem;padding:1.5rem .5rem;z-index:1;right:1px;min-width:1.5rem;margin-top:1px;height:1.5rem;font-size:1em;line-height:1em}.dui-input-text .dui-input-right:empty,.dui-input-text .dui-input-left:empty{--tw-bg-opacity: 1;background-color:rgba(0,0,0,var(--tw-bg-opacity))}.dui-input-text .dui-input-left{right:auto;left:1px}.dui-input-text[required] label:after{display:inline-flex;align-items:center;justify-content:center;vertical-align:middle;font-weight:600;line-height:1;--tw-text-opacity: 1;color:rgba(239,68,68,var(--tw-text-opacity));content:"*";height:1em;margin-left:.25em}.dui-input-text[rightSlotted] input[type]{padding-right:5rem}.dui-input-text[leftSlotted] input[type]{padding-left:2.75rem}
`;var xt=Object.defineProperty,St=Object.getOwnPropertyDescriptor,d=(s,e,i,r)=>{for(var t=r>1?void 0:r?St(e,i):e,n=s.length-1,a;n>=0;n--)(a=s[n])&&(t=(r?a(e,i,t):a(t))||t);return r&&t&&xt(e,i,t),t};let c=class extends k(bt){constructor(){super(...arguments),this.placeholder="",this.type="text",this.class="",this.value="",this.disabled=!1,this.autoforce=!1,this.required=!1,this.lower=!1,this.upper=!1,this.err=!1,this.debounce=300,this.rightSlotted=!1,this.leftSlotted=!1,this.onKeyup=s=>{s.key==="Enter"&&(this.emit("submit",this.value),setTimeout(()=>this.updateVal()))}}onSlotChange(s){const e=s.target;if(!e)return;e.assignedNodes({flatten:!0}).length}onSlotRight(s){this.rightSlotted=!!s.target}onSlotLeft(s){this.leftSlotted=!!s.target}firstUpdated(){if(this.autoforce){const s=this.$("input");s.focus(),s.select()}}onFocus(s){s.target.select()}updateVal(){const s=this.$("input");s&&(s.value=this.value)}onInput(s){s.stopImmediatePropagation();let e=s.target.value;this.lower&&(e=e.toLowerCase()),this.upper&&(e=e.toUpperCase()),this.value=e,this.updateVal(),this.emit("input",e)}render(){return f`<div class="dui-input-text ${this.class}" ?required="${this.required}" ?rightSlotted="${this.rightSlotted}" ?leftSlotted="${this.leftSlotted}" part="dui-input-text"><label><slot name="label" @slotchange="${this.onSlotChange}"></slot></label> <span class="dui-input-left"><slot name="left" @slotchange="${this.onSlotLeft}"></slot></span><input .type="${this.type}" .disabled="${this.disabled}" placeholder="${this.placeholder}" value="${this.value}" title="${this.title}" @focus="${this.onFocus}" @input="${this.onInput}" @keyup="${this.onKeyup}"><div class="dui-input-right"><slot name="right" @slotchange="${this.onSlotRight}"></slot></div><div class="dui-input-msg"><slot name="msg" @slotchange="${this.onSlotChange}"></slot></div><div class="dui-input-tip"><slot name="tip" @slotchange="${this.onSlotChange}"></slot></div></div>`}};d([u({type:String})],c.prototype,"placeholder",2);d([u({type:String})],c.prototype,"type",2);d([u({type:String})],c.prototype,"class",2);d([u({type:String})],c.prototype,"value",2);d([u({type:Boolean})],c.prototype,"disabled",2);d([u({type:Boolean})],c.prototype,"autoforce",2);d([u({type:Boolean})],c.prototype,"required",2);d([u({type:Boolean})],c.prototype,"lower",2);d([u({type:Boolean})],c.prototype,"upper",2);d([u({type:Boolean})],c.prototype,"err",2);d([u({type:Number})],c.prototype,"debounce",2);d([y()],c.prototype,"rightSlotted",2);d([y()],c.prototype,"leftSlotted",2);c=d([C("dui-input-text")],c);const _t="";var $t=Object.defineProperty,Ot=Object.getOwnPropertyDescriptor,g=(s,e,i,r)=>{for(var t=r>1?void 0:r?Ot(e,i):e,n=s.length-1,a;n>=0;n--)(a=s[n])&&(t=(r?a(e,i,t):a(t))||t);return r&&t&&$t(e,i,t),t};let p=class extends k(_t){constructor(){super(),this._checked={},this.inputNameRef=nt(),this.bindStore=new L(this,vt),this.bindBridge=new L(this,D),this.placeholder="",this.min=2,this.keyword="",this.err="",this.pending=!1,this.onInput=s=>{const{val:e,error:i,msg:r}=this.validateDOIDName(s);this.err=r,!i&&(this.keyword=e)},wt.bind(this,{allowAddress:!0})()}doSearch(){if(!D.bridge.account)return P.emit("connect-wallet");this.err||(this._checked.name&&(this.keyword=N(this.keyword)),this.emit("search",this.keyword))}connectedCallback(){super.connectedCallback();const{name:s="",address:e=""}=j(this.text,{wrap:!0});this.keyword=s||e}render(){return f`<dui-input-text class="scan-search" ${at(this.inputNameRef)} @input="${this.onInput}" @submit="${this.doSearch}" value="${this.keyword}" placeholder="${this.placeholder}" ?disabled="${this.pending}"><span slot="label"><slot name="label"></slot></span><span slot="right" class="-mr-1"><dui-button @click="${this.doSearch}" icon sm class="text-blue-500"><i class="mdi mdi-magnify text-lg"></i></dui-button></span><span slot="msg">${ot(this.err,()=>f`<span class="text-red-500">${this.err}</span>`,()=>f`<slot name="msgd"><span class="text-gray-400">Start looking up an artist or artwork by DOID, e.g. nocreative.doid, 5h.reva.doid/#3</span></slot>`)}</span></dui-input-text>`}};g([u()],p.prototype,"placeholder",2);g([u()],p.prototype,"min",2);g([u()],p.prototype,"text",2);g([y()],p.prototype,"keyword",2);g([y()],p.prototype,"err",2);g([y()],p.prototype,"pending",2);p=g([C("dui-ns-search")],p);const Dt="/assets/doid-15c8a698.svg";var Pt=Object.defineProperty,Nt=Object.getOwnPropertyDescriptor,jt=(s,e,i,r)=>{for(var t=r>1?void 0:r?Nt(e,i):e,n=s.length-1,a;n>=0;n--)(a=s[n])&&(t=(r?a(e,i,t):a(t))||t);return r&&t&&Pt(e,i,t),t};let z=class extends k(""){render(){return f`<strong class="block w-24 h-24 m-12 mx-auto" href="/"><img class="w-full h-full object-contain select-none pointer-events-none" src="${Dt}"></strong><div class="my-8 text-center"><strong class="block"><slot name="h1"></slot></strong><slot name="msg"></slot></div>`}};z=jt([C("doid-symbol")],z);export{At as a,Tt as b,Bt as c,It as d,v as g,mt as n,Rt as o,vt as s,gt as t};
